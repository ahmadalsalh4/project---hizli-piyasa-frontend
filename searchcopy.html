<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hızlı Piyasa - Ürün Ara</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../css/search-page.css" />
  </head>
  <body>
    <header>
      <div id="header"></div>
      <div id="search-barr"></div>
    </header>

    <div class="search-container">
      <div class="search-main">
        <div class="filters">
          <div class="filter-section">
            <div class="filter-title">
              Kategoriler
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="filter-options">
              <div class="filter-option">
                <input type="checkbox" id="cat-electronics" />
                <label for="cat-electronics">Elektronik</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-fashion" />
                <label for="cat-fashion">Moda</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-home" />
                <label for="cat-home">Ev, Bahçe</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-vehicle" />
                <label for="cat-vehicle">Araç</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="cat-property" />
                <label for="cat-property">Emlak</label>
              </div>
            </div>
          </div>

          <div class="filter-section">
            <div class="filter-title">
              Fiyat Aralığı
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="price-range">
              <input type="number" placeholder="Min TL" />
              <input type="number" placeholder="Max TL" />
            </div>
          </div>

          <div class="filter-section">
            <div class="filter-title">
              Konum
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="filter-options">
              <div class="filter-option">
                <input type="checkbox" id="loc-istanbul" />
                <label for="loc-istanbul">İstanbul</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="loc-ankara" />
                <label for="loc-ankara">Ankara</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="loc-izmir" />
                <label for="loc-izmir">İzmir</label>
              </div>
              <div class="filter-option">
                <input type="checkbox" id="loc-bursa" />
                <label for="loc-bursa">Bursa</label>
              </div>
            </div>
          </div>

          <div class="filter-section">
            <div class="filter-title">
              İlan Tarihi
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="date-filter">
              <select>
                <option value="">Tüm ilanlar</option>
                <option value="today">son 24 saat</option>
                <option value="3days">son 3 gün</option>
                <option value="week">Bu hafta</option>
                <option value="month">Bu ay</option>
              </select>
            </div>
          </div>

          <div class="filter-section">
            <button class="apply-filters">
              <i class="fas fa-filter"></i> Filtreleri Uygula
            </button>
          </div>
        </div>

        <div class="search-results">
          <div class="results-header">
            <div class="results-count">
              <h3 style="color: #212529" id="adcounter"></h3>
            </div>
            <div class="sort-options">
              <select>
                <option value="newest">En yeni ilanlar</option>
                <option value="oldest">En eski ilanlar</option>
                <option value="price-low">Fiyat (Düşükten yükseğe)</option>
                <option value="price-high">Fiyat (Yüksekten düşüğe)</option>
                <option value="name-asc">A-Z</option>
                <option value="name-desc">Z-A</option>
              </select>
            </div>
          </div>

          <div class="ads-grid" id="ads-card"></div>
        </div>
      </div>
    </div>

    <footer>
      <div id="footer"></div>
    </footer>

    <script type="module">
      import {
        LoadHeader,
        LogOut,
        LoadFooter,
        LoadSearch,
        loadCategoryNamesTo,
        loadcitiesNamesTo,
      } from "../js/util.js";
      import { loadProductsToSerch } from "../js/GetAllProducts.js";
      import { UpdateProfileState } from "../js/header.js";

      const urlParams = new URLSearchParams(window.location.search);
      const keyword = urlParams.get("search");
      document.addEventListener("DOMContentLoaded", async () => {
        await LoadHeader("header");
        await UpdateProfileState("header");
        await LoadSearch("search-barr");

        const adcount = await loadProductsToSerch(
          "ads-card",
          `http://localhost:5000/api/ads?search=${keyword}`
        );

        if (adcount != -1) {
          document.getElementById("adcounter").textContent =
            adcount + " ilan bulundu";
          document.getElementById("ads-card").addEventListener("click", (e) => {
            const card = e.target.closest(".ad-card");
            if (card) {
              const adId = card.getAttribute("data-ad-id");
              window.location.href = `ad-detailed.html?id=${adId}`;
            }
          });
        } else window.location.href = "./404.html";

        await LoadFooter("footer");
      });

      document.addEventListener("click", (e) => {
        if (e.target.id == "logoutButton") {
          LogOut();
        }
      });
    </script>
  </body>
</html>
