<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>İlan Ver | Hızlı Piyasa</title>
    <link rel="stylesheet" href="../css/post-ad.css" />
  </head>
  <body>
    <div class="container">
      <div class="post-ad-card">
        <h1 class="page-title">Yeni İlan Ver</h1>

        <form id="postAdForm">
          <div class="form-group">
            <label for="ad-title"
              >İlan Başlığı <span class="required">*</span></label
            >
            <input
              type="text"
              id="ad-title"
              name="ad-title"
              required
              placeholder="Örneğin: iPhone 12 128GB"
            />
          </div>

          <div class="form-group">
            <label for="ad-description"
              >Açıklama <span class="required">*</span></label
            >
            <textarea
              id="ad-description"
              name="ad-description"
              required
              placeholder="Ürününüzü detaylı bir şekilde anlatın"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="ad-category"
                >Kategori <span class="required">*</span></label
              >
              <select id="ad-category" name="ad-category" required>
                <option value="">Kategori seçin</option>
                <option value="electronics">Elektronik</option>
                <option value="fashion">Moda</option>
                <option value="home">Ev, Bahçe</option>
                <option value="vehicle">Araç</option>
                <option value="property">Emlak</option>
                <option value="other">Diğer</option>
              </select>
            </div>

            <div class="form-group">
              <label for="ad-city">Şehir <span class="required">*</span></label>
              <select id="ad-city" name="ad-city" required>
                <option value="">Şehir seçin</option>
                <option value="istanbul">İstanbul</option>
                <option value="ankara">Ankara</option>
                <option value="izmir">İzmir</option>
                <option value="bursa">Bursa</option>
                <option value="antalya">Antalya</option>
                <!-- Diğer şehirler eklenebilir -->
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="ad-price"
                >Fiyat (TL) <span class="required">*</span></label
              >
              <input
                type="number"
                id="ad-price"
                name="ad-price"
                required
                placeholder="Örneğin: 5000"
              />
            </div>
          </div>

          <div class="form-group">
            <label>Ürün Resimleri <span class="required">*</span></label>
            <div class="image-upload" id="imageUpload">
              <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <div class="upload-text">
                Resimleri buraya sürükleyip bırakın veya tıklayarak seçin
              </div>
              <div class="upload-hint">
                Maksimum 10 resim (Her biri max 5MB)
              </div>
            </div>
            <input
              type="file"
              id="ad-images"
              name="ad-images"
              multiple
              accept="image/*"
              style="display: none"
            />

            <div class="preview-container" id="imagePreview">
              <!-- Resim önizlemeleri burada gösterilecek -->
            </div>
          </div>

          <button type="submit" class="submit-btn">İlanı Yayınla</button>
        </form>
      </div>
    </div>

    <script>
      // Resim yükleme işlevselliği
      const imageUpload = document.getElementById("imageUpload");
      const fileInput = document.getElementById("ad-images");
      const imagePreview = document.getElementById("imagePreview");

      imageUpload.addEventListener("click", () => {
        fileInput.click();
      });

      // Sürükle bırak desteği
      imageUpload.addEventListener("dragover", (e) => {
        e.preventDefault();
        imageUpload.style.borderColor =
          getComputedStyle(imageUpload).getPropertyValue("--primary-color"); //var(--primary-color);
        imageUpload.style.backgroundColor = "rgba(67, 97, 238, 0.1)";
      });

      imageUpload.addEventListener("dragleave", () => {
        imageUpload.style.borderColor = "#ddd";
        imageUpload.style.backgroundColor = "transparent";
      });

      imageUpload.addEventListener("drop", (e) => {
        e.preventDefault();
        imageUpload.style.borderColor = "#ddd";
        imageUpload.style.backgroundColor = "transparent";

        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          updateImagePreview();
        }
      });

      fileInput.addEventListener("change", updateImagePreview);

      function updateImagePreview() {
        imagePreview.innerHTML = "";

        if (fileInput.files.length > 10) {
          alert("Maksimum 10 resim yükleyebilirsiniz!");
          return;
        }

        for (let i = 0; i < Math.min(fileInput.files.length, 10); i++) {
          const file = fileInput.files[i];

          // Dosya boyutu kontrolü (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            alert(`${file.name} dosyası çok büyük (max 5MB)`);
            continue;
          }

          const reader = new FileReader();

          reader.onload = function (e) {
            const preview = document.createElement("div");
            preview.className = "image-preview";
            preview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <div class="remove-image" data-index="${i}">&times;</div>
                    `;
            imagePreview.appendChild(preview);

            // Resim kaldırma butonu
            preview
              .querySelector(".remove-image")
              .addEventListener("click", (e) => {
                e.stopPropagation();
                removeImage(i);
              });
          };

          reader.readAsDataURL(file);
        }
      }

      function removeImage(index) {
        const dt = new DataTransfer();
        const files = Array.from(fileInput.files);

        files.splice(index, 1);

        files.forEach((file) => {
          dt.items.add(file);
        });

        fileInput.files = dt.files;
        updateImagePreview();
      }

      // Form gönderimi
      document
        .getElementById("postAdForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Basit doğrulama
          if (fileInput.files.length === 0) {
            alert("Lütfen en az bir resim ekleyin!");
            return;
          }

          // Burada form verilerini sunucuya gönderebilirsiniz
          alert("İlan başarıyla gönderildi! Yönlendiriliyorsunuz...");
          // window.location.href = "my-ads.html";
        });
    </script>
  </body>
</html>
